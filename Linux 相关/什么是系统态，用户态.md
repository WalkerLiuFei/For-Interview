# 内核态，用户态

内核态和用户态是操作系统的两种运行级别，和具体的 CPU架构没有关系

1. **定义 ：**

   当一个进程在执行系统调用而陷入内核代码中执行时，我们就称进程处于内核运行态。而其他属于用户态。用户态不能干扰内核态.所以CPU指令就有两种,特权指令和非特权指令.不同的状态对应不同的指令。特权指令：只能由操作系统内核部分使用，不允许用户直接使用的指令。**如，I/O指令、置终端屏蔽指令、清内存、建存储保护、设置时钟指令**。

2. **CPU 状态的切换**

   1. **用户态--->内核态：**唯一途径是通过中断、异常、陷入机制（访管指令）
   2. **内核态--->用户态：**设置程序状态字PSW

3. **内核态与用户态的区别：**

   1. **内核态与用户态是操作系统的两种运行级别，当程序运行在3级特权级上时，就可以称之为运行在用户态。**因为这是最低特权级，是普通的用户进程运行的特权级，大部分用户直接面对的程序都是运行在用户态；
   2. **当程序运行在0级特权级上时，就可以称之为运行在内核态。**
   3. 运行在用户态下的程序不能直接访问操作系统内核数据结构和程序。当我们在系统中执行一个程序时，大部分时间是运行在用户态下的，在其需要操作系统帮助完成某些它没有权力和能力完成的工作时就会切换到内核态。
   4. 这两种状态的主要差别是: 处于用户态执行时，进程所能访问的内存空间和对象受到限制，其所处于占有的处理机是可被抢占的 ；而处于内核态执行中的进程，则能访问所有的内存空间和对象，且所占有的处理机是不允许被抢占的。

4. **通常来说，以下三种情况会导致用户态到内核态的切换：**

   1. 系统调用 ： 用户态进程主动要求切换到内存态的方式，**用户态进程通过系统调用申请使用操作系统提供的服务程序完成工作**， 例如fork操作创建一个新进程的系统调用
   2. 异常 ： 当CPU在执行运行在用户态下的程序时，发生了某些事先不可知的异常，这时会触发由当前运行进程切换到处理此异常的内核相关程序中，也就转到了内核态，比如缺页异常。
   3. **外围设备的中断** ： **当外围设备完成用户请求的操作后，会向CPU发出相应的中断信号**，这时CPU会暂停执行下一条即将要执行的指令转而去执行与中断信号对应的处理程序。 **如硬盘的读写操作时** 


**内核地址空间** ： 当进程进入到内核态时，进程在内存地址空间



