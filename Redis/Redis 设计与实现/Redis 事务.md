# Redis事务

以`MULTI` 命令开启一个事务，然后客户端发送其他命令然后进入队列，当客户端发送`EXEC`,`DISCARD`,`WATCH`,`MULTI` 四个命令中的一个，那么服务器会立即执行这个命令，如果是发送的其他命令就会先将这些命令入队列等待执行。

## Watch命令

`watch`命令是一个乐观锁，它可以在`EXEC`命令执行之前，监视任意数量的数据库键，并在`EXEC`命令执行时，检查被监视的键是否至少有一个被修改过了，如果是的话，服务器将拒绝执行事务，并向客户端返回代表事务执行失败的空回复。

Redis通过 `CAS`保护 事务的原子性。

## Redis的ACID 属性

Redis可以有原子性，但是没有回滚机制，也就是说，就算中途某个指令执行失败，整个事务的命令依旧会执行下去。

Redis无论运行在哪一种持久化模式下，都不影响`Redis`事务的一致性。

Redis运行在单线程模式下，所以隔离性不是Redis事务重点考虑的地方。

Redis的事务总是具有`ACID`中的原子性，一致性和隔离性。当服务器运行在`AOF`持久化模式下，并且`appendfsync`选项为`always`时，事务也具有持久性。